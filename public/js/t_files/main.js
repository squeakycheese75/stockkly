!function(a,b){if("function"==typeof define&&define.amd)return define("locservices/core/api",b);void 0===a.locservices&&(a.locservices={}),void 0===a.locservices.core&&(a.locservices.core={}),a.locservices.core.API=b()}(this,function(){"use strict";function a(a,b){var c;for(c in a)a.hasOwnProperty(c)&&!b.hasOwnProperty(c)&&(b[c]=a[c]);return b}function b(a,b){return Number(Math.round(a+"e"+b)+"e-"+b)}function c(b){var c,e="";this._defaultParams={},this.apiKey="",this._options=a({env:"live",protocol:"http"},b||{});var f=d(this._options);for(c in f)f.hasOwnProperty(c)&&"env"!==c&&"protocol"!==c&&(this._defaultParams[c]=f[c]);"live"!==this._options.env&&(e="."+this._options.env),void 0!==this._options.api_key&&(this.apiKey=this._options.api_key),this.setLocatorEndpoint(this._options,e),this._hasXHR=void 0!==window.XMLHttpRequest}function d(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&((typeof a[b]).match(/string|number/)?c[b]=a[b]:"[object Array]"===Object.prototype.toString.call(a[b])&&(c[b]=a[b].join(",")));return c}c.prototype.setLocatorEndpoint=function(a,b){".live"!==b&&"."!==b||(b=""),this._apiBaseUri=a.protocol+"://locator-service"+b+".api.bbci.co.uk",this._baseUri=a.protocol+"://www"+b+".bbc.co.uk/locator/default"},c.prototype.getDefaultQueryParameters=function(){return this._defaultParams},c.prototype.getLocation=function(b,c){var e="",f="location";c.params=a(this._defaultParams,d(c||{})),c.detailTypes&&"[object Array]"===Object.prototype.toString.call(c.detailTypes)&&(f="details",e="/details/"+c.detailTypes.join(","),c.params.vv=2);var g="/locations/"+encodeURIComponent(b)+e;this.request(g,c,f)},c.prototype.search=function(b,c){c.params=a(this._defaultParams,d(c||{})),c.params.s=b,c.success=function(){var a=c.success,d=b,e=c.params.start;return function(b){b.metadata.search=d,e&&(b.metadata.start=e),a(b)}}(),this.request("/locations",c,"search")},c.prototype.autoComplete=function(b,c){c.params=a(this._defaultParams,d(c||{})),c.params.s=b,c.params.a="true",this.request("/locations",c,"autoComplete")},c.prototype.reverseGeocode=function(c,e,f){f.params=a(this._defaultParams,d(f||{})),f.params.la=b(c,3),f.params.lo=b(e,3),this.request("/locations",f,"reverseGeocode")},c.prototype.getCookie=function(a,b){"object"!=typeof a?b.error("API.prototype.getCookie now requires a full location search result object to be passed as an argument instead of a location id"):b.success(this.generateCookieResponse(a,b))},c.prototype.generateCookieResponse=function(a,b){var c=new Date;return c.setFullYear(c.getFullYear()+1),{cookie:this.formulateCookieFromLocation(a,b),expires:c.getTime()/1e3,id:a.id,name:a.name,news:[],type:"location"}},c.prototype.formulateCookieFromLocation=function(a,b){var c=encodeURIComponent(a.name);c=c.replace(/%20/g,"+");var d;b&&b.params&&b.params.news_region_id&&(d=b.params.news_region_id);var e=encodeURIComponent(a.container);return e=e.replace(/\%20/g,"+"),"3#l1#i="+a.id+":n="+c+":h=0:c="+e+":p="+a.placeType+":y="+a.country+function(a){return"@w1#i=0:p="+a}(c)+"@d1#1=0:2=0:3=0:4=0"+function(){return"@n1#r="+(d||0)}()},c.prototype.request=function(a,b,c,d){b.params.format="json",b.params.api_key=d||this.apiKey;var h,i="function"==typeof window.addEventListener?window.addEventListener:window.attachEvent,j="function"==typeof window.removeEventListener?window.removeEventListener:window.detachEvent,k=a+g(b.params),l=this,m=!1,n=function(){window.ActiveXObject&&j("onunload",r)},o=function(a){var d;try{d=u(a.responseText),setTimeout(function(){b.success(f(d,c))})}catch(c){b.error&&b.error(a.status)}},p=function(a){a.onreadystatechange=function(c){4===a.readyState&&(b.success&&a.status<400&&null!==a.responseText?o(a):b.error&&b.error(a.status),n())}},q=function(a){a.onload=function(){b.success&&(void 0===a.status||a.status<400)&&null!==a.responseText?o(a):b.error&&b.error(a.status),n()},a.onerror=function(){b.error&&b.error(a.status),n()}},r=function(){m=!0,h.onload=h.onerror=h.onreadystatechange=null,h.abort()},s=function(a){m||"function"!=typeof b.error||b.error(a)};window.ActiveXObject&&i("onunload",r);var t=function(a){return"cookie"===c||"api"!==a?l._baseUri+k:l._apiBaseUri+k},u=function(a){if(window.JSON&&window.JSON.parse)try{return window.JSON.parse(a)}catch(a){return null}return"string"==typeof a?new Function("return "+a)():null};if(this._hasXHR&&(h=new XMLHttpRequest),h&&"withCredentials"in h)try{h.open("GET",t("api"),!0),q(h)}catch(a){s(a)}else if(void 0!==window.XDomainRequest)h=new XDomainRequest,h.open("GET",t("api")),q(h);else if(h)try{h.open("GET",t("")),p(h)}catch(a){s(a)}else void 0!==window.ActiveXObject?(h=new ActiveXObject("Microsoft.XMLHTTP"),h.open("GET",t(""),!0),p(h)):e(t("api"),b,c);if(void 0!==h)try{h.send(null)}catch(a){r(),n(),b.error&&b.error(400)}};var e=function(a,b,c){var d,e;e="_locservices_core_api_cb_"+(new Date).getTime()+Math.round(1e5*Math.random()),b.params.format="jsonp",b.params.jsonp=e,window[e]=function(a){try{delete window[e]}catch(a){window[e]=void 0}document.body.removeChild(d),b.success&&b.success(f(a,c))},d=document.createElement("script"),d.src=a+g(b.params),"function"==typeof b.error&&(d.onerror=b.error),document.body.appendChild(d)},f=function(a,b){var c={};switch(b){case"cookie":c=a;break;case"location":c.location=a.response;break;case"details":c.location=a.response.metadata.location,c.details=a.response.content.details.details;break;case"search":c.results=a.response.locations,c.metadata={totalResults:a.response.totalResults};break;case"autoComplete":c.results=a.response.results.results,c.metadata={totalResults:a.response.results.totalResults};break;case"reverseGeocode":c.results=a.response.results.results}return c},g=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c+"="+encodeURIComponent(a[c]));return"?"+b.join("&")};return c}),define("locservices/ui/mediator/events",[],function(){"use strict";function a(){}var b={};return a.prototype.on=function(a,c){b[a]=b[a]||[],b[a].push(c)},a.prototype.emit=function(a,c){b[a]=b[a]||[],b[a].forEach(function(a){a(c||{})})},a.prototype.clear=function(a){if(a)for(var c in b)c.match(a)&&(b[c]=void 0);else b={}},new a}),define("locservices/ui/component/component",["locservices/ui/mediator/events"],function(a){"use strict";function b(){this.events=a}return b.prototype.setComponentOptions=function(a){if(a=a||{},void 0===a.translations)throw new Error("Component requires a translations parameter.");if(this.translations=a.translations,void 0===a.container)throw new Error("Component requires container parameter.");this.container=a.container,this.componentId=a.componentId||"component",this.eventNamespaceBase="locservices:ui",a.eventNamespace&&(this.eventNamespaceBase=a.eventNamespace),this.eventNamespace=this.eventNamespaceBase+":component:"+this.componentId},b.prototype.emit=function(a,b){b=b||[];var c=this.eventNamespace;"error"===a&&(c=this.eventNamespaceBase),this.events.emit(c+":"+a,b)},b.prototype.on=function(a,b){var c=this.eventNamespace;"error"===a&&(c=this.eventNamespaceBase),this.events.on(c+":"+a,b)},b.prototype.listenTo=function(a,b,c){var d=[this.eventNamespaceBase,"component",a,b];this.events.on(d.join(":"),c)},b}),define("locservices/ui/utils/utils",[],function(){return{findLocationById:function(a,b){for(var c=String(a),d=0;d<b.length;d++)if(String(b[d].id)===c)return b[d];return!1},locationInArrayById:function(a,b){for(var c=String(a,10),d=0;d<b.length;d++)if(String(b[d].id,10)===c)return!0;return!1},debounce:function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}},createElement:function(a,b){var c=document.createElement(a);return null!==b&&(void 0!==b&&"#"===b.charAt(0)?c.id=b.slice(1):this.addClass(c,b)),c},addClass:function(a,b){if(a&&b){var c=-1!==b.search(" "),d=""!==a.className;if(void 0===a.classList||""===a.classList||""===b||c){var e=d?" ":"";a.className+=e+b}else a.classList.add(b)}},removeClass:function(a,b){a&&(a.classList?a.classList.remove(b):a.className=a.className.replace(new RegExp("(^|\\b)"+b.split(" ").join("|")+"(\\b|$)","gi")," "))},hasClass:function(a,b){try{return null!==a&&(a.classList?a.classList.contains(b):new RegExp("(^| )"+b+"( |$)","gi").test(a.className))}catch(a){return!1}},trigger:function(a,b,c){var d;"function"==typeof CustomEvent?d=new CustomEvent(b,{detail:c,bubbles:!0,cancelable:!0}):(d=document.createEvent("CustomEvent"),d.initCustomEvent(b,!0,!0,c)),a.dispatchEvent(d)},click:function(a){var b=document.createEvent("MouseEvent");b.initMouseEvent("click",!0,!0,window,null,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(b)},keyPress:function(a,b,c){var d=document.createEvent("Event");d.keyCode=a,d.initEvent(b),c.dispatchEvent(d)}}}),function(a,b){if("function"==typeof define&&define.amd)return define("locservices/core/geolocation",b);void 0===a.locservices&&(a.locservices={}),void 0===a.locservices.core&&(a.locservices.core={}),a.locservices.core.geolocation=b()}(this,function(){function a(){return"geolocation"in navigator}function b(b,c,d){return d=d||{timeout:1e4,maximumAge:60,enableHighAccuracy:!0},!!a()&&(navigator.geolocation.getCurrentPosition(b,c,d),!0)}return{isSupported:a(),getCurrentPosition:b}}),define("text",{}),function(a,b){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?b(exports):"function"==typeof define&&define.amd?define("mustache",["exports"],b):(a.Mustache={},b(a.Mustache))}(this,function(a){function b(a){return"function"==typeof a}function c(a){return p(a)?"array":typeof a}function d(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function e(a,b){return null!=a&&"object"==typeof a&&b in a}function f(a,b){return q.call(a,b)}function g(a){return!f(r,a)}function h(a){return String(a).replace(/[&<>"'`=\/]/g,function(a){return s[a]})}function i(b,c){function e(a){if("string"==typeof a&&(a=a.split(u,2)),!p(a)||2!==a.length)throw new Error("Invalid tags: "+a);f=new RegExp(d(a[0])+"\\s*"),h=new RegExp("\\s*"+d(a[1])),i=new RegExp("\\s*"+d("}"+a[1]))}if(!b)return[];var f,h,i,m=[],n=[],o=[],q=!1,r=!1;e(c||a.tags);for(var s,y,z,A,B,C,D=new l(b);!D.eos();){if(s=D.pos,z=D.scanUntil(f))for(var E=0,F=z.length;E<F;++E)A=z.charAt(E),g(A)?o.push(n.length):r=!0,n.push(["text",A,s,s+1]),s+=1,"\n"===A&&function(){if(q&&!r)for(;o.length;)delete n[o.pop()];else o=[];q=!1,r=!1}();if(!D.scan(f))break;if(q=!0,y=D.scan(x)||"name",D.scan(t),"="===y?(z=D.scanUntil(v),D.scan(v),D.scanUntil(h)):"{"===y?(z=D.scanUntil(i),D.scan(w),D.scanUntil(h),y="&"):z=D.scanUntil(h),!D.scan(h))throw new Error("Unclosed tag at "+D.pos);if(B=[y,z,s,D.pos],n.push(B),"#"===y||"^"===y)m.push(B);else if("/"===y){if(!(C=m.pop()))throw new Error('Unopened section "'+z+'" at '+s);if(C[1]!==z)throw new Error('Unclosed section "'+C[1]+'" at '+s)}else"name"===y||"{"===y||"&"===y?r=!0:"="===y&&e(z)}if(C=m.pop())throw new Error('Unclosed section "'+C[1]+'" at '+D.pos);return k(j(n))}function j(a){for(var b,c,d=[],e=0,f=a.length;e<f;++e)(b=a[e])&&("text"===b[0]&&c&&"text"===c[0]?(c[1]+=b[1],c[3]=b[3]):(d.push(b),c=b));return d}function k(a){for(var b,c,d=[],e=d,f=[],g=0,h=a.length;g<h;++g)switch(b=a[g],b[0]){case"#":case"^":e.push(b),f.push(b),e=b[4]=[];break;case"/":c=f.pop(),c[5]=b[2],e=f.length>0?f[f.length-1][4]:d;break;default:e.push(b)}return d}function l(a){this.string=a,this.tail=a,this.pos=0}function m(a,b){this.view=a,this.cache={".":this.view},this.parent=b}function n(){this.cache={}}var o=Object.prototype.toString,p=Array.isArray||function(a){return"[object Array]"===o.call(a)},q=RegExp.prototype.test,r=/\S/,s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},t=/\s*/,u=/\s+/,v=/\s*=/,w=/\s*\}/,x=/#|\^|\/|>|\{|&|=|!/;l.prototype.eos=function(){return""===this.tail},l.prototype.scan=function(a){var b=this.tail.match(a);if(!b||0!==b.index)return"";var c=b[0];return this.tail=this.tail.substring(c.length),this.pos+=c.length,c},l.prototype.scanUntil=function(a){var b,c=this.tail.search(a);switch(c){case-1:b=this.tail,this.tail="";break;case 0:b="";break;default:b=this.tail.substring(0,c),this.tail=this.tail.substring(c)}return this.pos+=b.length,b},m.prototype.push=function(a){return new m(a,this)},m.prototype.lookup=function(a){var c,d=this.cache;if(d.hasOwnProperty(a))c=d[a];else{for(var f,g,h=this,i=!1;h;){if(a.indexOf(".")>0)for(c=h.view,f=a.split("."),g=0;null!=c&&g<f.length;)g===f.length-1&&(i=e(c,f[g])),c=c[f[g++]];else c=h.view[a],i=e(h.view,a);if(i)break;h=h.parent}d[a]=c}return b(c)&&(c=c.call(this.view)),c},n.prototype.clearCache=function(){this.cache={}},n.prototype.parse=function(a,b){var c=this.cache,d=c[a];return null==d&&(d=c[a]=i(a,b)),d},n.prototype.render=function(a,b,c){var d=this.parse(a),e=b instanceof m?b:new m(b);return this.renderTokens(d,e,c,a)},n.prototype.renderTokens=function(a,b,c,d){for(var e,f,g,h="",i=0,j=a.length;i<j;++i)g=void 0,e=a[i],f=e[0],"#"===f?g=this.renderSection(e,b,c,d):"^"===f?g=this.renderInverted(e,b,c,d):">"===f?g=this.renderPartial(e,b,c,d):"&"===f?g=this.unescapedValue(e,b):"name"===f?g=this.escapedValue(e,b):"text"===f&&(g=this.rawValue(e)),void 0!==g&&(h+=g);return h},n.prototype.renderSection=function(a,c,d,e){function f(a){return g.render(a,c,d)}var g=this,h="",i=c.lookup(a[1]);if(i){if(p(i))for(var j=0,k=i.length;j<k;++j)h+=this.renderTokens(a[4],c.push(i[j]),d,e);else if("object"==typeof i||"string"==typeof i||"number"==typeof i)h+=this.renderTokens(a[4],c.push(i),d,e);else if(b(i)){if("string"!=typeof e)throw new Error("Cannot use higher-order sections without the original template");null!=(i=i.call(c.view,e.slice(a[3],a[5]),f))&&(h+=i)}else h+=this.renderTokens(a[4],c,d,e);return h}},n.prototype.renderInverted=function(a,b,c,d){var e=b.lookup(a[1]);if(!e||p(e)&&0===e.length)return this.renderTokens(a[4],b,c,d)},n.prototype.renderPartial=function(a,c,d){if(d){var e=b(d)?d(a[1]):d[a[1]];return null!=e?this.renderTokens(this.parse(e),c,d,e):void 0}},n.prototype.unescapedValue=function(a,b){var c=b.lookup(a[1]);if(null!=c)return c},n.prototype.escapedValue=function(b,c){var d=c.lookup(b[1]);if(null!=d)return a.escape(d)},n.prototype.rawValue=function(a){return a[1]},a.name="mustache.js",a.version="2.3.2",a.tags=["{{","}}"];var y=new n;return a.clearCache=function(){return y.clearCache()},a.parse=function(a,b){return y.parse(a,b)},a.render=function(a,b,d){if("string"!=typeof a)throw new TypeError('Invalid template! Template should be a "string" but "'+c(a)+'" was given as the first argument for mustache#render(template, view, partials)');return y.render(a,b,d)},a.to_html=function(c,d,e,f){var g=a.render(c,d,e);if(!b(f))return g;f(g)},a.escape=h,a.Scanner=l,a.Context=m,a.Writer=n,a}),define("stache",{load:function(a){throw new Error("Dynamic load not allowed: "+a)}}),define("stache!locservices/ui/templates/geolocation",["mustache"],function(a){var b='<button type="button" title="{{ label }}" class="ls-ui-comp ls-c-geolocation gel-pica {{#wide}}ls-c-geolocation--wide{{/wide}}">\n  <span class="ls-c-geolocation__label">{{ label }}</span>\n  <span class="ls-c-geolocation__icon"></span>\n</button>\n';return a.parse(b),function(c,d){return a.render(b,c,d)}}),define("locservices/ui/component/geolocation",["locservices/ui/component/component","locservices/ui/utils/utils","locservices/core/geolocation","stache!locservices/ui/templates/geolocation"],function(a,b,c,d){function e(a,b){return function(){return a.apply(b,arguments)}}function f(a){if(this.isSupported=c.isSupported,!1!==this.isSupported){if(a=a||{},a.componentId="geolocation","object"!=typeof a.api)throw new Error("Gelocation requires an API option.");this.api=a.api;var b=this;this.setComponentOptions(a),this.emit("available");var e=this.translations.get("geolocation.button.label"),f={wide:a.wide,label:e};this.container.innerHTML=d(f),this._button=this.container.querySelector(".ls-c-geolocation"),this._button.addEventListener("click",function(a){a.preventDefault(),b.emit("click"),b.reverseGeocode()})}}return f.prototype=new a,f.prototype.constructor=f,f.prototype.reverseGeocode=function(){function a(a){var c=a.coords.longitude,d=a.coords.latitude;f.api.reverseGeocode(d,c,{success:function(a){var c=a.results[0];c.isWithinContext?(f._button.setAttribute("isDisabled","false"),b.removeClass(f._button,"ls-c-geolocation--disabled"),f.emit("location",[c])):f.emit("error",[{code:"geolocation.error.outsideContext",message:"Your location is not currently supported by this application"}])},error:function(){f.emit("error",[{code:"geolocation.error.http",message:"We were unable to make a location api request"}])}})}function d(a){var b="geolocation.error.browser",c="An error occurred obtaining the browsers position. Error code "+a.code;a.code===a.PERMISSION_DENIED&&(b+=".permission",~a.message.indexOf("secure origin")&&(b+=".insecure_origin")),this.emit("error",[{code:b,message:c}])}var f=this;this._button.setAttribute("isDisabled","true"),b.addClass(this._button,"ls-c-geolocation--disabled"),this.emit("start"),c.getCurrentPosition(e(a,this),e(d,this))},f}),define("stache!locservices/ui/templates/search",["mustache"],function(a){var b='<div class="ls-c-search">\n\n  <div class="ls-c-search__container" aria-autocomplete="list" role="combobox">\n    <input id="ls-c-search__input-label" type="text" class="ls-c-search__input gel-pica" placeholder="{{ placeholder }}" autocomplete="off" aria-owns="location-list" aria-described="{{ placeholder }}" aria-expanded="false" aria-autocomplete="list" role="combobox">\n  </div>\n  <input type="submit" class="ls-c-search__submit" value="{{ submit }}" title="{{ title }}">\n\n  {{#hasClearButton}}\n    <button class="ls-c-search__clear-button">{{ clear }}</button>\n  {{/hasClearButton}}\n\n</div>\n';return a.parse(b),function(c,d){return a.render(b,c,d)}}),define("stache!locservices/ui/templates/search_form",["mustache"],function(a){var b='<form method="post" action="#" class="ls-o-form">\n  {{{ searchHtml }}}\n</form>\n';return a.parse(b),function(c,d){return a.render(b,c,d)}}),define("locservices/ui/component/search",["locservices/ui/component/component","locservices/ui/utils/utils","stache!locservices/ui/templates/search","stache!locservices/ui/templates/search_form"],function(a,b,c,d){"use strict";function e(a){var c,d=this;if(a=a||{},a.componentId="search",d.hasForm=void 0===a.hasForm||a.hasForm,void 0===a.api)throw new Error("Search requires api parameter");d.api=a.api,d.setComponentOptions(a),d.isSearching=!1,d.hasAValidSearchTerm=!1,d.locationName=a.locationName,c="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,f(d.translations,d.container,c,d.hasForm),d.input=d.container.querySelector("input[type=text]"),d.input.addEventListener("keydown",function(){d.input.value===d.locationName&&(d.input.value=""),d.checkInput()}),"string"==typeof d.locationName&&(d.input.value=d.locationName),c&&(this.hasClearControl=!0,d.container.querySelector(".ls-c-search__clear-button").addEventListener("click",function(){d.clear()})),d.componentWrapper=d.container.querySelector(".ls-c-search"),d.formWrapper=d.container.querySelector("form"),d.searchButton=d.container.querySelector(".ls-c-search__submit"),d.hasForm?d.formWrapper.addEventListener("submit",function(a){a.preventDefault(),d.search(d.input.value)}):(d.input.addEventListener("keydown",function(a){var b="which"in a?a.which:a.keyCode;13!==b&&10!==b||d.search(d.input.value)}),d.searchButton.addEventListener("click",function(){d.search(d.input.value)})),d.input.addEventListener("focus",function(){d.input.value===d.locationName&&(d.input.value=""),d.emit("focus")}),d.container.querySelector("input[type=submit]").addEventListener("click",function(){b.trigger(d.input,"submit")}),this.events.on(d.eventNamespaceBase+":component:auto_complete:results",function(){d.input.setAttribute("aria-expanded",!0)}),this.events.on(d.eventNamespaceBase+":component:search_results:results",function(){d.input.setAttribute("aria-expanded",!0)}),this.events.on(d.eventNamespaceBase+":controller:inactive",function(){void 0!==d.locationName&&(d.input.value=d.locationName)})}e.prototype=new a,e.prototype.constructor=e,e.prototype.clear=function(){this.input.value="",this.input.setAttribute("aria-expanded",!1),this.hasAValidSearchTerm=!1,b.removeClass(this.componentWrapper,"ls-c-search--term"),this.hasClearControl&&b.removeClass(this.componentWrapper,"ls-c-search--clear"),this.emit("clear")},e.prototype.checkInput=function(){0<this.input.value.length?!1===this.hasAValidSearchTerm&&(this.hasAValidSearchTerm=!0,b.addClass(this.componentWrapper,"ls-c-search--term"),this.hasClearControl&&b.addClass(this.componentWrapper,"ls-c-search--clear")):this.hasAValidSearchTerm&&this.clear()},e.prototype.search=function(a){var b=this;(a=(a||"").replace(/^\s+|\s+$/g,""))&&!0!==b.isSearching&&(b.emit("start",[a]),b.isSearching=!0,b.api.search(a,{success:function(a){b.emit("end"),b.isSearching=!1,b.emit("results",[a.results,a.metadata])},error:function(){b.emit("end"),b.isSearching=!1,b.emit("error",[{code:"search.error.search",message:"There was an API error searching for "+a}])}}))};var f=function(a,b,e,f){var g;g=c(function(a){return{placeholder:a.get("search.placeholder"),submit:a.get("search.submit"),title:a.get("search.submit.title"),clear:a.get("search.clear"),hasClearButton:e}}(a)),f&&(g=d({searchHtml:g})),b.innerHTML=g};return e}),define("stache!locservices/ui/templates/search_results",["mustache"],function(a){var b='<div class="ls-c-search_results ls-c-locations-list{{#isActive}} ls-c-locations-list--hidden{{/isActive}}">\n  <ul class="ls-c-locations-list-list" role="listbox" id="location-list" aria-expanded="{{expanded}}">\n    {{#locations}}\n    <li class="ls-c-locations-list-item" role="option">\n      <a class="ls-o-location ls-o-location--dark gel-pica" href="" data-id="{{ id }}">\n        <span class="gel-long-primer">{{name}}{{#container}}, {{container}}{{/container}}</span>\n      </a>\n    </li>\n    {{/locations}}\n  </ul>\n  {{#hasMoreResults}}\n    <button class="ls-o-toggle ls-o-toggle--down ls-o-location-more gel-long-primer-bold" title="{{ translations.show_more_title }}">\n      <span aria-hidden="true">{{ translations.show_more }}</span>\n      <span class="gs-u-vh ls-u-hidden">{{ translations.show_more_title }}</span>\n    </button>\n  {{/hasMoreResults}}\n</div>\n';return a.parse(b),function(c,d){return a.render(b,c,d)}}),define("locservices/ui/component/search_results",["locservices/ui/component/component","stache!locservices/ui/templates/search_results"],function(a,b){"use strict";function c(a){if(a=a||{},a.componentId="search_results",this.persistResultsOnClick=!0===a.persistResultsOnClick,void 0===a.api)throw new Error("SearchResults requires api parameter");this.api=a.api,this.setComponentOptions(a),this._locations=[],this.offset=0,this._waitingForSearchResults=!1,this.listenTo("search","results",d.bind(this)),this.listenTo("search","clear",function(){this.clear()}.bind(this)),this.listenTo("search","start",function(){this.clear()}.bind(this)),this.render()}var d=function(a){if(this._waitingForSearchResults=!1,Array.isArray(a)&&(a={metadata:a[1],results:a[0]}),1===a.metadata.totalResults){var b=a.results[0];return this.emit("location",[b]),void this.emit("result-single",{searchTerm:a.metadata.search})}this.offset=a.metadata.start||0,this.searchTerm=a.metadata.search,this._locations=this._locations.concat(a.results),this.render(a.metadata.totalResults>10&&this.offset+10<a.metadata.totalResults),this.emit("results",{searchTerm:this.searchTerm,offset:this.offset,totalResults:a.metadata.totalResults})},e=function(a){this.emit("show_more:clicked"),a.preventDefault(),!0!==this._waitingForSearchResults&&(this._waitingForSearchResults=!0,this.api.search(this.searchTerm,{start:this.offset+10,success:d.bind(this)}))},f=function(a){a.preventDefault();var b=a.currentTarget.querySelector(".ls-o-location"),c=b.getAttribute("data-id"),d=this._locations.filter(function(a){return a.id===c})[0];this.emit("location:clicked",d);var e=this._locations.indexOf(d);return!0!==this.persistResultsOnClick&&this.clear(),this.emit("location",[d,e]),!1};return c.prototype=new a,c.prototype.constructor=c,c.prototype.render=function(a){a=a||!1,this.container.innerHTML=b({locations:this._locations,isActive:0===this._locations.length,hasMoreResults:a,translations:{show_more:this.translations.get("search_results.more"),show_more_title:this.translations.get("search_results.more_title")}});var c=this.container.querySelector(".ls-o-location-more");null!==c&&c.addEventListener("click",e.bind(this));for(var d=this.container.querySelector(".ls-c-locations-list-list"),g=d.querySelectorAll("li"),h=d.querySelector("li:nth-child("+(this.offset+1)+") a"),i=0;i<g.length;i++)g[i].addEventListener("click",f.bind(this),!1);null!==h&&h.focus()},c.prototype.clear=function(){this._locations=[],this._waitingForSearchResults=!1,this.render()},c}),define("stache!locservices/ui/templates/auto_complete",["mustache"],function(a){var b='<div class="ls-c-auto_complete ls-c-locations-list">\n<ul class="ls-c-locations-list-list" role="listbox" id="location-list">\n\t{{#locations}}\n\t<li class="ls-c-locations-list-item" role="option" aria-selected="false">\n\t\t<a class="ls-o-location ls-o-location--dark gel-pica" href="" data-id="{{ id }}">\n\t\t\t<span class="gel-long-primer" aria-hidden="true">{{&formattedName}}{{#container}}, {{container}}{{/container}}</span>\n\t\t\t<span class="ls-u-hidden">{{name}}{{#container}}, {{container}}{{/container}}</span>\n\t\t</a>\n\t</li>\n\t{{/locations}}\n</ul>\n</div>\n';return a.parse(b),function(c,d){return a.render(b,c,d)}}),define("locservices/ui/component/auto_complete",["locservices/ui/component/component","locservices/ui/utils/utils","stache!locservices/ui/templates/auto_complete"],function(a,b,c){function d(a){var c=this;if(a=a||{},a.componentId="auto_complete","object"!=typeof a.api)throw new Error("AutoComplete requires an api option");if(!(a.element instanceof HTMLElement))throw new Error("AutoComplete requires an element option");c._waitingForResults=!1,c._searchSubmitted=!1,c._timeoutId=void 0,c._highlightedSearchResultIndex=null,c._api=a.api,c.input=a.element,c.searchResultsData=[],c.currentSearchTerm="",c.registrationPostcode=null,c.delegates=a.delegates||null,c.setComponentOptions(a),function(a){a.on("results",function(b){a.render(b.results,a.currentSearchTerm)})}(c),function(a){a.listenTo("search","start",function(){a._searchSubmitted=!0,a.requestedSearchTerm=void 0,a.currentSearchTerm=a.prepareSearchTerm(a.input.value)})}(c),function(a){a.listenTo("search","clear",function(){a.requestedSearchTerm=void 0,a.currentSearchTerm="",a.clear()})}(c),function(a){a.input.addEventListener("keydown",function(b){var c=b.keyCode;(c===e.escape||c===e.enter||c===e.downArrow||c===e.tab)&&a.verifyKey.call(a,b)})}(c),function(a){a.input.addEventListener("keyup",function(b){var c=b.keyCode;if(c!==e.escape&&c!==e.enter&&c!==e.downArrow&&c!==e.tab)return void a.autoComplete()})}(c),function(a){a.input.addEventListener("blur",function(){for(var c=a.container.querySelectorAll("li"),d=0;d<c.length;d++){var e=c[d].querySelector("a");e&&b.removeClass(e,"ls-o-location--active")}})}(c),c.input.setAttribute("autocomplete","off")}var e={enter:13,escape:27,upArrow:38,downArrow:40,tab:9},f=function(a){a.stopPropagation(),a.preventDefault()},g=function(a){var b=a.currentTarget,c=b.parentNode,d=Array.prototype.indexOf.call(c.children,b);this.highlightSearchResultByIndex(a,d,!1)},h=function(a){var c=a.currentTarget;b.removeClass(c.querySelector("a"),"ls-o-location--active")},i=function(a){var b=a.currentTarget,c=b.parentNode,d=Array.prototype.indexOf.call(c.children,b),e=this.searchResultsData[d];this.emit("location",[e,this.currentSearchTerm]),this.clear()},j=function(a){var b=a.keyCode,c=a.target.parentElement.parentElement,d=c.lastElementChild.querySelector("a"),f=c.length,g=c.firstElementChild.querySelector("a"),h=b===e.escape||b===e.enter||b===e.upArrow||b===e.downArrow||b===e.tab;if(a.target===d&&b===e.downArrow)return this.highlightSearchResultByIndex(a,f,!0),!1;a.target===g&&b===e.upArrow&&this.input.focus(),h&&this.verifyKey.call(this,a)};return d.prototype=new a,d.prototype.constructor=d,d.prototype.verifyKey=function(a){var b,c=this;if(window.event?b=window.event.keyCode:a&&(b=a.which),a.shiftKey&&b===e.tab)return void c.highlightPrevSearchResult(a);switch(b){case e.escape:c.escapeKeyHandler();break;case e.enter:c.enterKeyHandler(a);break;case e.upArrow:c.highlightPrevSearchResult(a);break;case e.downArrow:case e.tab:c.highlightNextSearchResult(a)}},d.prototype.autoComplete=function(){var a=this,b=this.prepareSearchTerm(a.input.value),c=b.length<2;if(this._waitingForResults||c||b===a.currentSearchTerm)return void(c&&a.currentSearchTerm&&(a.clear(!0),a.currentSearchTerm=""));a.currentSearchTerm=b,clearTimeout(this._timeoutId),this._timeoutId=setTimeout(function(){!0!==a._searchSubmitted&&b!==a.requestedSearchTerm&&(a._waitingForResults=!0,a.requestedSearchTerm=b,a._api.autoComplete(b,{success:function(c){if(a._waitingForResults=!1,!1===a._searchSubmitted&&a.currentSearchTerm===a.requestedSearchTerm){var d=a.combineResultsWithDelegateData.call(a,b,c);a.emit("results",{results:d.results,metadata:d.metadata,searchTerm:b})}a.requestedSearchTerm=void 0},error:function(){a._waitingForResults=!1,!1===a._searchSubmitted&&a.currentSearchTerm===a.requestedSearchTerm&&a.emit("error",[{code:"auto_complete.error.search",message:"There was a problem searching for the search term"}]),a.requestedSearchTerm=void 0}}))},500),this._searchSubmitted=!1},d.prototype.setRegistrationPostcode=function(a){"object"==typeof a&&"name"in a&&"id"in a&&(a.name=a.name.slice(0,4),this.registrationPostcode=a),"string"==typeof a&&(this.registrationPostcode={id:a.slice(0,4),name:a.slice(0,4)})},d.prototype.getRegistrationPostcode=function(){return this.registrationPostcode},d.prototype.getMyLocationsDelegate=function(){return this.delegates&&"myLocationsDelegate"in this.delegates?this.delegates.myLocationsDelegate:null},d.prototype.getRecentLocationsDelegate=function(){return this.delegates&&"recentLocationsDelegate"in this.delegates?this.delegates.recentLocationsDelegate:null},d.prototype.combineResultsWithDelegateData=function(a,b){var c=this.getMyLocationsDelegate(),d=this.getRecentLocationsDelegate(),e=[],f=[],g=[],h=this.getRegistrationPostcode();if(null===this.delegates)return b;c&&(e=c.getLocationsFromCache(),null!==h&&(e=[h].concat(e)),f=this.searchLocationsArray(e,a,"myLocations")),d&&(e=d.getLocationsFromCache(),g=this.searchLocationsArray(e,a,"recentLocations"));for(var i=f.concat(g),j=[],k=0;k<i.length;k++)for(var l=i[k],m=0;m<b.results.length;m++)b.results[m].id===l.id&&j.push(m);for(var n=0;n<j.length;n++)b.results.splice(j[n],1);return b.results=f.concat(g,b.results),b},d.prototype.searchLocationsArray=function(a,b,c){for(var d=[],e=0;e<a.length;e++)a[e].name.slice(0,b.length).toLowerCase()===b.toLowerCase()&&(a[e].type=c,d.push(a[e]));return d.sort(function(a,b){return a.name<b.name?-1:a.name>b.name?1:0}),d},d.prototype.clear=function(a){this.searchResultsData=[],this._highlightedSearchResultIndex=null,this.container.innerHTML="",a&&this.emit("clear")},d.prototype.render=function(a,b){if(0===a.length)return void this.clear();this.searchResultsData=a,this.emit("render"),a=this.emboldenSearchTermInResults(b,a);var d=c({locations:a});this.container.innerHTML=d;for(var e=this.container.querySelectorAll("li"),k=0;k<e.length;k++){var l=e[k];l.querySelector("a").addEventListener("click",f),l.addEventListener("mouseover",g.bind(this)),l.addEventListener("mouseout",h.bind(this)),l.addEventListener("mousedown",i.bind(this)),l.addEventListener("keydown",j.bind(this))}},d.prototype.emboldenSearchTermInResults=function(a,b){for(var c=a.toLowerCase(),d=c.replace(/\b[a-z]/g,function(a){return a.toUpperCase()
}),e=0;e<b.length;e++)b[e].name&&(b[e].formattedName=b[e].name.replace(d,'<span class="gel-long-primer-bold">'+d+"</span>"));return b},d.prototype.escapeKeyHandler=function(){this.searchResultsData&&(null!==this._highlightedSearchResultIndex&&this.input.setAttribute("value",this.currentSearchTerm),this.clear(!0))},d.prototype.enterKeyHandler=function(a){if(null!==this._highlightedSearchResultIndex){a.preventDefault();var b=this.searchResultsData[this._highlightedSearchResultIndex];this.emit("location",[b,this.currentSearchTerm])}this.clear()},d.prototype.prepareSearchTerm=function(a){if("number"==typeof a)a=String(a);else if("string"!=typeof a)return"";return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},d.prototype.highlightNextSearchResult=function(a){if(0!==this.searchResultsData.length){var b=this._highlightedSearchResultIndex;if(null===b)b=0;else if(b++,this.searchResultsData.length<=b)return void this.removeSearchResultHighlight(!0);this.highlightSearchResultByIndex(a,b,!0)}},d.prototype.highlightPrevSearchResult=function(a){if(0!==this.searchResultsData.length){var b=this._highlightedSearchResultIndex;if(null===b)b=this.searchResultsData.length-1;else if(0>--b)return void this.removeSearchResultHighlight(!0);this.highlightSearchResultByIndex(a,b,!0)}},d.prototype.highlightSearchResultByIndex=function(a,c,d){a.preventDefault(),a.stopPropagation();var e=c+1,f=this.searchResultsData[c];if(void 0===f)return!1;var g=f.name;f.container&&(g+=", "+f.container),this.removeSearchResultHighlight(),this._highlightedSearchResultIndex=c,b.addClass(this.container.querySelector("li:nth-child("+e+") a"),"ls-o-location--active"),this.container.querySelector("li:nth-child("+e+") a").focus(),this.container.querySelector("li:nth-child("+e+")").setAttribute("aria-selected",!0),d&&(this.input.value=g)},d.prototype.removeSearchResultHighlight=function(a){var c=this.container.querySelector(".ls-o-location--active");c&&(this._highlightedSearchResultIndex=null,c.parentNode.setAttribute("aria-selected",!1),b.removeClass(c,"ls-o-location--active")),a&&(this.input.value=this.currentSearchTerm)},d}),define("stache!locservices/ui/templates/close_button",["mustache"],function(a){var b='<button class="ls-ui-comp-close_button" title="{{ label }}">\n  <span aria-hidden="true">{{ label }}</span>\n  <span class="ls-u-hidden">{{ title }}</span>\n</button>\n';return a.parse(b),function(c,d){return a.render(b,c,d)}}),define("locservices/ui/component/close_button",["locservices/ui/component/component","stache!locservices/ui/templates/close_button"],function(a,b){"use strict";function c(a){a=a||{},a.componentId="close_button",this.setComponentOptions(a),this.container.insertAdjacentHTML("beforeend",b({label:this.translations.get("close_button.label"),title:this.translations.get("close_button.label_locations")})),this.button=this.container.querySelector(".ls-ui-comp-close_button"),this.button.addEventListener("click",function(a){a.preventDefault(),this.emit("clicked")}.bind(this))}return c.prototype=new a,c.prototype.constructor=c,c}),define("stache!locservices/ui/templates/message",["mustache"],function(a){var b='<div class="ls-c-message{{#isCloseable}} ls-c-message--closeable{{/isCloseable}}">\n  <div class="ls-c-message__container">\n    <p class="gel-long-primer ls-c-message__content{{#isActive}} ls-c-message__content--active{{/isActive}}" aria-live="polite">{{&message}}</p>\n    {{#isCloseable}}\n    <button class="ls-o-btn ls-o-btn--icon ls-o-btn--icon-hide ls-o-btn--right ls-c-message-button">\n      <span class="ls-u-hidden">{{ translations.close }}</span>\n    </button>\n    {{/isCloseable}}\n  </div>\n</div>\n';return a.parse(b),function(c,d){return a.render(b,c,d)}}),define("locservices/ui/component/message",["locservices/ui/component/component","locservices/ui/utils/utils","stache!locservices/ui/templates/message"],function(a,b,c){"use strict";function d(a){e=this,a=a||{},a.componentId="message",e.outerDiv=a.outerDiv,e.state={active:!1,closeable:!1,sticky:!1,mylocation:!1},e.setComponentOptions(a),e.clear(),e.on("error",function(a){"object"==typeof a&&(Array.isArray(a)&&(a=a[0]),a.code===f&&(e.state.mylocation=!0),e.state.closeable=a.closeable,a=void 0!==a.code?e.translations.get(a.code):a.message),e.set(a)}),e.listenTo("search","clear",function(){e.clear()}),e.listenTo("search","start",function(){e.clear()}),e.listenTo("geolocation","click",function(){e.clear()}),e.listenTo("search_results","results",function(a){if(Array.isArray(a)&&(a=a[0]),0===a.totalResults&&void 0!==a.searchTerm){var b=e.translations.get("search.error.no_results",{searchTerm:a.searchTerm});return void e.set(b)}var c=a.offset+10;c=c>a.totalResults?a.totalResults:c,e.set("<strong>"+e.translations.get("message.total_results.formatted",{current:c,total:a.totalResults})+"</strong>")})}var e,f="user_locations.error.preferred_location",g=function(a,d,e,f,g){var h=document.querySelector(".li-c-user-profile-location"),i={message:f,isCloseable:e.active&&e.closeable,isActive:e.active,isSticky:e.sticky,isMyLocation:e.mylocation,translations:{close:d.get("message.action.close")}};if(!0===e.closeable&&!0===e.active)e.sticky||null===g||e.mylocation||g.insertAdjacentHTML("beforebegin",c(i)),e.mylocation&&h&&h.insertAdjacentHTML("beforebegin",c(i)),e.sticky=!0;else{a.innerHTML=c(i);var j=document.querySelector(".ls-c-message--closeable");j&&j.remove()}b.addClass(a,"gs-u-display-none")};return d.prototype=new a,d.prototype.constructor=d,d.prototype.clear=function(){this.state.active=!1,this.state.closeable=!1,this.state.sticky=!1,this.state.mylocation=!1,g(this.container,this.translations,this.state,"",this.outerDiv)},d.prototype.escape=function(a){return String(a).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},d.prototype.unescape=function(a){return String(a).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'")},d.prototype.unescapeWhitelist=function(a){for(var b=["strong"],c=new RegExp("&lt;(.*?)&gt;"),d=new RegExp("&lt;/(.*?)&gt;"),e=0;e<b.length;e++){var f=b[e],g=c.exec(a),h=d.exec(a);g&&g[1]===f&&(a=a.replace(new RegExp(g[0],"g"),this.unescape(g[0]))),h&&h[1]===f&&(a=a.replace(new RegExp(h[0],"g"),this.unescape(h[0])))}return a},d.prototype.set=function(a){if("string"!=typeof a)return!1;this.state.active=!0;var c=this.unescapeWhitelist(this.escape(a));g(this.container,this.translations,this.state,c,this.outerDiv),b.removeClass(this.container,"gs-u-display-none");var d=document.querySelector(".ls-c-message--closeable")||this.outerDiv.parentElement.querySelector(".ls-c-message--closeable"),f=d?d.querySelector(".ls-c-message-button"):null;return null===f||(f.addEventListener("click",function(a){a.preventDefault(),e.clear()}),!0)},d}),function(a,b){if("function"==typeof define&&define.amd)return define("locservices/core/recent_locations",b);void 0===a.locservices&&(a.locservices={}),void 0===a.locservices.core&&(a.locservices.core={}),a.locservices.core.RecentLocations=b()}(this,function(){function a(a){return a=a||{},!!a.hasOwnProperty("placeType")&&!("postcode"!==a.placeType&&"district"!==a.placeType&&!a.hasOwnProperty("container"))&&a.id&&"string"==typeof a.id&&a.name}function b(){this._prefix="locservices-recent-locations"}function c(a){if(this.isSupported()&&(this._storageAdapter=new b),a=a||{},this.MAX_LOCATIONS=a.maxLocations||4,isNaN(this.MAX_LOCATIONS)||this.MAX_LOCATIONS<0)throw new Error("Invalid max location value")}var d=function(){var a="bbc-locservices-core-js";try{return localStorage.setItem(a,a),localStorage.removeItem(a),!0}catch(a){return!1}}(),e=d?localStorage:{},f="object"==typeof window.JSON&&d;return b.prototype.get=function(){var a=[];if(!e[this._prefix])return a;try{a=JSON.parse(e[this._prefix])}catch(a){}return a},b.prototype.set=function(a){if("[object Array]"!==Object.prototype.toString.call(a))return!1;e[this._prefix]=JSON.stringify(a)},c.prototype.isSupported=function(){return f},c.prototype.all=function(){return void 0===this._storageAdapter?[]:this._storageAdapter.get()},c.prototype.add=function(b){if(void 0===this._storageAdapter||!a(b))return!1;if(this.contains(b.id))return this.remove(b.id),this.add(b),!0;var c=this._storageAdapter.get();return c.unshift(b),this.MAX_LOCATIONS<c.length&&(c=c.slice(0,this.MAX_LOCATIONS)),this._storageAdapter.set(c),!0},c.prototype.remove=function(a){var b,c,d=[];if(void 0===this._storageAdapter)return!1;b=this._storageAdapter.get();for(c in b)b.hasOwnProperty(c)&&b[c].id.toString()!==a.toString()&&d.push(b[c]);this._storageAdapter.set(d)},c.prototype.clear=function(){return void 0!==this._storageAdapter&&(this._storageAdapter.set([]),!0)},c.prototype.contains=function(a){var b,c,d=!1;if(void 0===this._storageAdapter)return!1;b=this._storageAdapter.get();for(c in b)b.hasOwnProperty(c)&&b[c].id===a&&(d=!0);return d},c}),function(a,b){if("function"==typeof define&&define.amd)return define("locservices/core/cookies",b);void 0===a.locservices&&(a.locservices={}),void 0===a.locservices.core&&(a.locservices.core={}),a.locservices.core.Cookies=b()}(this,function(){function a(){}return a.prototype.isSupported=function(){var a="locservices_ui_test_cookie",b=!1;return this.set(a,"test"),"test"===this.get(a)&&(b=!0),this.unset(a),b},a.prototype.hasItem=function(a){return new RegExp("(?:^|;\\s*)"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},a.prototype.get=function(a){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},a.prototype.set=function(a,b,c,d,e){var f;return!(!a||/^(?:expires|max\-age|path|domain|secure)$/i.test(a))&&(c&&"string"!=typeof c&&(c=void 0),f=encodeURIComponent(a)+"="+encodeURIComponent(b)+(c?"; expires="+c:"")+(e?"; domain="+e:"")+(d?"; path="+d:""),document.cookie=f,f)},a.prototype.unset=function(a,b,c){var d;return!(!a||!this.hasItem(a))&&(d=encodeURIComponent(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(c?"; domain="+c:"")+(b?"; path="+b:""),document.cookie=d,d)},a}),function(a,b){if("function"==typeof define&&define.amd)return define("locservices/core/bbc_cookies",b);void 0===a.locservices&&(a.locservices={}),void 0===a.locservices.core&&(a.locservices.core={}),a.locservices.core.BBCCookies=b()}(this,function(){function a(){this._isSupported="object"==typeof window.bbccookies,this._isSupported&&(this._policy=window.bbccookies.readPolicy())}return a.prototype.isSupported=function(){return this._isSupported},a.prototype.readPolicy=function(){return!!this._isSupported&&this._policy},a.prototype.isPersonalisationDisabled=function(){return!!this._isSupported&&!1===this._policy.personalisation},a}),function(a,b){if("function"==typeof define&&define.amd)return define("locservices/core/data/tvandradio",b);void 0===a.locservices&&(a.locservices={}),void 0===a.locservices.core&&(a.locservices.core={}),void 0===a.locservices.core.data&&(a.locservices.core.data={}),a.locservices.core.data.TvAndRadio=b()}(this,function(){function a(){}var b=function(a){return{c:"bbc_one_cambridge",ci:"bbc_one_channel_islands",e:"bbc_one_east",em:"bbc_one_east_midlands",l:"bbc_one_london",ne:"bbc_one_north_east",nw:"bbc_one_north_west",ni:"bbc_one_northern_ireland",o:"bbc_one_oxford",sc:"bbc_one_scotland",s:"bbc_one_south",se:"bbc_one_south_east",sw:"bbc_one_south_west",wa:"bbc_one_wales",w:"bbc_one_west",wm:"bbc_one_west_midlands",ey:"bbc_one_east_yorkshire",y:"bbc_one_yorks"}[a]},c=function(a){return{e:"bbc_two_england",n:"bbc_two_northern_ireland_digital",s:"bbc_two_scotland",w:"bbc_two_wales_digital"}[a]},d=function(a){return{e:"bbc_radio_one",n:"bbc_radio_one_northern_ireland",s:"bbc_radio_one_scotland",w:"bbc_radio_one_wales"}[a]},e=function(a){var b={2:"bbc_london",3:"bbc_radio_berkshire",4:"bbc_radio_bristol",5:"bbc_radio_cambridge",6:"bbc_radio_cornwall",7:"bbc_radio_coventry_warwickshire",8:"bbc_radio_cumbria",9:"bbc_radio_cymru",10:"bbc_radio_derby",11:"bbc_radio_devon",12:"bbc_radio_essex",13:"bbc_radio_foyle",14:"bbc_radio_gloucestershire",15:"bbc_radio_guernsey",16:"bbc_radio_hereford_worcester",17:"bbc_radio_humberside",18:"bbc_radio_jersey",19:"bbc_radio_kent",20:"bbc_radio_lancashire",21:"bbc_radio_leeds",22:"bbc_radio_leicester",23:"bbc_radio_lincolnshire",24:"bbc_radio_manchester",25:"bbc_radio_merseyside",26:"bbc_radio_nan_gaidheal",27:"bbc_radio_newcastle",28:"bbc_radio_norfolk",29:"bbc_radio_northampton",30:"bbc_radio_nottingham",31:"bbc_radio_orkney",32:"bbc_radio_oxford",33:"bbc_radio_scotland",34:"bbc_radio_sheffield",35:"bbc_radio_shetland",36:"bbc_radio_shropshire",37:"bbc_radio_solent",38:"bbc_radio_somerset_sound",39:"bbc_radio_stoke",40:"bbc_radio_suffolk",41:"bbc_radio_surrey",42:"bbc_radio_sussex",43:"bbc_radio_ulster",44:"bbc_radio_wales_fm",45:"bbc_radio_wiltshire",46:"bbc_radio_york",47:"bbc_tees",48:"bbc_three_counties_radio",49:"bbc_wm"};if("string"==typeof a){for(var c=a.split("."),d=[],e=0;e<c.length;e++)d.push(b[c[e]]);return d}};return a.prototype.get=function(a){var f,g=!1,h=typeof a;return"object"===h&&null!==a?g={bbc_one:b(a[1]),bbc_two:c(a[2]),bbc_radio_one:d(a[3]),local_radio:e(a[4])}:"string"===h&&(f=a.split(","),4<=f.length&&(g={bbc_one:f[0],bbc_two:f[1],bbc_radio_one:f[2],local_radio:f.slice(3)})),g},a.prototype.convertToUASString=function(a){var b,c;return c=function(a,c){"string"==typeof a&&a.length>0&&(b+=a),c&&(b+=",")},b="","object"!=typeof a?b:(c(a.bbc_one,!0),c(a.bbc_two,!0),c(a.bbc_radio_one,!1),"[object Array]"===Object.prototype.toString.call(a.local_radio)&&0<a.local_radio.length&&(b+=","+a.local_radio.join(",")),b)},a}),function(a,b){if("function"==typeof define&&define.amd)return define("locservices/core/data/news",b);void 0===a.locservices&&(a.locservices={}),void 0===a.locservices.core&&(a.locservices.core={}),void 0===a.locservices.core.data&&(a.locservices.core.data={}),a.locservices.core.data.News=b()}(this,function(){function a(){}var b={1:{id:"threecounties",path:"england/beds_bucks_and_herts",name:"Beds Herts &amp; Bucks",locServicesId:"1"},3:{id:"berkshire",path:"england/berkshire",name:"Berkshire",locServicesId:"3"},4:{id:"birmingham",path:"england/birmingham_and_black_country",name:"Birmingham and Black Country",locServicesId:"4"},7:{id:"bristol",path:"england/bristol",name:"Bristol",locServicesId:"7"},8:{id:"cambridgeshire",path:"england/cambridgeshire",name:"Cambridgeshire",locServicesId:"8"},11:{id:"cornwall",path:"england/cornwall",name:"Cornwall",locServicesId:"11"},12:{id:"coventry",path:"england/coventry_and_warwickshire",name:"Coventry &amp; Warwickshire",locServicesId:"12"},13:{id:"cumbria",path:"england/cumbria",name:"Cumbria",locServicesId:"13"},16:{id:"derby",path:"england/derbyshire",name:"Derby",locServicesId:"16"},17:{id:"devon",path:"england/devon",name:"Devon",locServicesId:"17"},18:{id:"dorset",path:"england/dorset",name:"Dorset",locServicesId:"18"},19:{id:"edinburghandeastscotland",path:"scotland/edinburgh_east_and_fife",name:"Edinburgh Fife &amp; East of Scotland",locServicesId:"19"},20:{id:"essex",path:"england/essex",name:"Essex",locServicesId:"20"},21:{id:"northernireland",path:"northern_ireland",name:"Northern Ireland",locServicesId:"21"},22:{id:"glasgowandwestscotland",path:"scotland/glasgow_and_west",name:"Glasgow &amp; West of Scotland",locServicesId:"22"},23:{id:"gloucestershire",path:"england/gloucestershire",name:"Gloucestershire",locServicesId:"23"},26:{id:"guernsey",path:"world/europe/guernsey",name:"Guernsey",locServicesId:"26"},27:{id:"hampshire",path:"england/hampshire",name:"Hampshire &amp; Isle of Wight",locServicesId:"27"},28:{id:"28",path:"england/hereford_and_worcester",name:"Hereford &amp; Worcester",locServicesId:"herefordandworcester"},30:{id:"highlandsandislands",path:"scotland/highlands_and_islands",name:"Highlands &amp; Islands",locServicesId:"30"},31:{id:"humberside",path:"england/humberside",name:"Humberside",locServicesId:"31"},32:{id:"isleofman",path:"world/europe/isle_of_man",name:"Isle of Man",locServicesId:"32"},33:{id:"jersey",path:"world/europe/jersey",name:"Jersey",locServicesId:"33"},34:{id:"kent",path:"england/kent",name:"Kent",locServicesId:"34"},35:{id:"lancashire",path:"england/lancashire",name:"Lancashire",locServicesId:"35"},36:{id:"leeds",path:"england/leeds_and_west_yorkshire",name:"Leeds &amp; West Yorkshire",locServicesId:"36"},37:{id:"leicester",path:"england/leicester",name:"Leicestershire",locServicesId:"37"},38:{id:"lincolnshire",path:"england/lincolnshire",name:"Lincolnshire",locServicesId:"38"},39:{id:"liverpool",path:"england/merseyside",name:"Liverpool",locServicesId:"39"},40:{id:"london",path:"england/london",name:"London",locServicesId:"40"},41:{id:"manchester",path:"england/manchester",name:"Manchester",locServicesId:"41"},42:{id:"midwales",path:"wales/mid_wales",name:"Mid Wales",locServicesId:"midwales"},43:{id:"norfolk",path:"england/norfolk",name:"Norfolk",locServicesId:"43"},44:{id:"northampton",path:"england/northamptonshire",name:"Northampton",locServicesId:"44"},45:{id:"northeastscotlandnorthernisles",path:"scotland/north_east_orkney_and_shetland",name:"North East Scotland Orkney &amp; Shetland",locServicesId:"45"},46:{id:"northeastwales",path:"wales/north_east_wales",name:"North East Wales",locServicesId:"46"},47:{id:"northwestwales",path:"wales/north_west_wales",name:"North West Wales",locServicesId:"47"},48:{id:"york",path:"england/york_and_north_yorkshire",name:"York &amp; North Yorkshire",locServicesId:"48"},49:{id:"nottingham",path:"england/nottingham",name:"Nottinghamshire",locServicesId:"49"},50:{id:"oxford",path:"england/oxford",name:"Oxford",locServicesId:"50"},51:{id:"shropshire",path:"england/shropshire",name:"Shropshire",locServicesId:"51"},52:{id:"somerset",path:"england/somerset",name:"Somerset",locServicesId:"52"},53:{id:"southeastwales",path:"wales/south_east_wales",name:"South East Wales",locServicesId:"53"},55:{id:"southscotland",path:"scotland/south_scotland",name:"South Scotland",locServicesId:"55"},56:{id:"southwestwales",path:"wales/south_west_wales",name:"South West Wales",locServicesId:"56"},57:{id:"sheffield",path:"england/south_yorkshire",name:"Sheffield &amp; South Yorkshire",locServicesId:"57"},58:{id:"stoke",path:"england/stoke_and_staffordshire",name:"Stoke &amp; Staffordshire",locServicesId:"58"},59:{id:"suffolk",path:"england/suffolk",name:"Suffolk",locServicesId:"59"},60:{id:"sussex",path:"england/sussex",name:"Sussex",locServicesId:"60"},61:{id:"taysideandcentralscotland",path:"scotland/tayside_and_central",name:"Tayside &amp; Central Scotland",locServicesId:"61"},62:{id:"tees",path:"england/tees",name:"Tees",locServicesId:"62"},63:{id:"tyne",path:"england/tyne_and_wear",name:"Tyne and Wear",locServicesId:"63"},65:{id:"wiltshire",path:"england/wiltshire",name:"Wiltshire",locServicesId:"65"},66:{id:"surrey",path:"england/surrey",name:"Surrey",locServicesId:"66"}};return a.prototype.get=function(a){var c,d,e=[],f=typeof a;if("number"===f)a=[a];else{if("string"!==f)return!1;a=a.split(/[,.]+/g)}for(c=0;c<a.length;c++)d=a[c],void 0!==b[d]&&e.push(b[d]);return e},a.prototype.convertToUASString=function(a){var b,c,d,e;if(e="",void 0===a||"[object Array]"!==Object.prototype.toString.call(a)||0===a.length)return e;for(c=[],b=0;b<a.length;b++)"string"!=typeof(d=a[b].locServicesId)&&"number"!=typeof d||c.push(d);return c.join(",")},a}),function(a,b){if("function"==typeof define&&define.amd)return define("locservices/core/data/weather",b);void 0===a.locservices&&(a.locservices={}),void 0===a.locservices.core&&(a.locservices.core={}),void 0===a.locservices.core.data&&(a.locservices.core.data={}),a.locservices.core.data.Weather=b()}(this,function(){function a(){}return a.prototype.get=function(a){var b={},c=typeof a;if("string"===c){if(a=a.split(","),2!==a.length)return!1;b.id=a[0],b.name=a[1]}else{if("object"!==c||null===a||void 0===a.i||void 0===a.p)return!1;b.id=String(a.i),b.name=a.p}return b},a.prototype.convertToUASString=function(a){var b;return b="","object"!=typeof a||null===a||void 0===a.id||void 0===a.name?b:b=a.id+","+a.name},a}),define("locservices/core/metadata_parser",[],function(){return{parse:function(a){a.version="0.1";for(var b=["latitude","longitude","timezone"],c=b.length,d=0;d<c;d++){var e=b[d];a[e]&&delete a[e]}return a.details&&(a.details,delete a.details),a}}}),function(a,b){if("function"==typeof define&&define.amd)return define("locservices/core/uas_locations",["uasclient","./data/tvandradio","./data/news","./data/weather","./metadata_parser"],b);void 0===a.locservices&&(a.locservices={}),void 0===a.locservices.core&&(a.locservices.core={}),a.locservices.core.UASLocations=b(a.locservices.core.data.TvAndRadio,a.locservices.core.data.News,a.locservices.core.data.Weather)}(this,function(a,b,c,d,e){"use strict";function f(b,c,d){var e;if(c=c||{},this._isSupported=!1,this.debug="object"==typeof c&&!0===c.debug,g=c.uasClient||a,this.idcta=d,g&&"object"==typeof b&&"co.uk"===b.domainSuffix){try{null===g.getObj&&g.init(b)}catch(a){this._handleUASClientException(a),e=!0}e||!0!==g.userSignedIn||(this._isSupported=!0)}this._uasFavouritesRequestObject={resourceDomain:"profile",resourceType:h,activityType:"favourites",action:"favourited"},this._uasFollowsRequestObject={resourceDomain:"location",resourceType:h,activityType:"favourites",action:"favourited"},this._uasRequestObject={resourceDomain:"location",activityType:"favourites",action:"favourited"}}var g,h="geonameid",i=function(a){a&&"function"==typeof a.error&&a.error()},j=function(a,b){a&&"function"==typeof a.success&&a.success(b)};return f.prototype._handleUASClientException=function(a){if(this.debug)throw a},f.prototype.isSupported=function(){return this._isSupported},f.prototype.getUASClient=function(a){return g},f.prototype.getPreferred=function(a){if(!1===this._isSupported)return void i(a);this.get({success:function(b){var c,d;for(d=0;d<b.length;d++)if("object"==typeof(c=b[d])&&"preferred"===c.locationType)return void j(a,c);j(a)},error:function(){i(a)}})},f.prototype.setPreferred=function(a,b){var c;if(c=this,!1===this._isSupported||"object"!=typeof a)return void i(b);this.removePreferred({success:function(){a.locationType="preferred",c.create(a,b)},error:function(){i(b)}})},f.prototype.removePreferred=function(a){var b;if(b=this,!1===this._isSupported)return void i(a);this.getPreferred({success:function(c){"object"==typeof c?b.remove(c.id,a):j(a)},error:function(){i(a)}})},f.prototype.all=function(a){if(!1===this._isSupported)return void i(a);this.get({success:function(b){this.getPreferred({success:function(c){if(c&&"object"==typeof c){for(var d=String(c.id),e=!1,f=0;f<b.length;f++)d===String(b[f].id)&&(e=!0);!1===e&&(b.unshift(c),this.createFollow(c,function(){},function(){}))}j(a,b)}.bind(this),error:function(){j(a,b)}})}.bind(this),error:function(){i(a)}},this._uasRequestObject)},f.prototype.get=function(a,e){var f,h,k,l,m,n,o=new c,p=new b,q=new d;if(e=e||this._uasFavouritesRequestObject,f=function(b){var c,d,e;try{c=JSON.parse(b.responseText)}catch(b){return this._handleUASClientException(b),void i(a)}if(c&&c.items instanceof Array){for(d=[],e=0;e<c.items.length;e++)h=c.items[e].metaData,k=o.get(h.news),l=p.get(h.tvandradio),m=q.get(h.weather),!0===k&&delete h.news,!0===l&&delete h.tvandradio,!0===m&&delete h.weather,d.push(h);j(a,d)}else j(a,[])},n=function(a,b){b.initiateTokenRefresh();try{return void console.log("token refresh successful!")}catch(a){console.log("token refresh failed!",a)}},!1===this._isSupported)return void i(a);try{g.get(e,function(b,c){if(b){if("object"==typeof b&&408===b.status)return;if("object"==typeof b&&401===b.status)return void n(a,this.idcta);i(a)}else"object"!=typeof c||200!==c.status&&202!==c.status?i(a):f(c)}.bind(this))}catch(b){this._handleUASClientException(b),i(a)}},f.prototype.remove=function(a,b,c,d){var e,f,k;if(!1===this._isSupported||"string"!=typeof a&&"number"!=typeof a)return void i(b);c=c||this._uasFavouritesRequestObject.activityType,f=d||this._uasFavouritesRequestObject.resourceDomain,k=/^[0-9]*$/.test(a)?h:"postcodedistrict",e="urn:bbc:"+f+":"+k+":"+String(a);try{g.remove({activityType:c,globalId:e},function(a,c){a?i(b):"object"==typeof c&&202===c.status?j(b):i(b)})}catch(a){this._handleUASClientException(a),i(b)}},f.prototype.create=function(a,b,c){if(c=c||this._uasFavouritesRequestObject,!1===this._isSupported||"object"!=typeof a||void 0===a.id)return void i(b);"object"==typeof a.details&&void 0!==a.details?a=e.parse(a):(void 0!==a.news&&delete a.news,void 0!==a.tvandradio&&delete a.tvandradio,void 0!==a.weather&&delete a.weather);try{this.setResourceType(c,a.placeType);var d=c;d.resourceId=a.id||"",d.resourceTitle=a.name||"",d.url=void 0!==typeof window?window.location.href:"",d.metaData=JSON.stringify(a)||{},g.create(d,function(a,c){a?i(b):j(b)})}catch(a){this._handleUASClientException(a),i(b)}},f.prototype.createFollow=function(a,b){this.create(a,b,this._uasFollowsRequestObject)},f.prototype.removeFollow=function(a,b){this.remove(a,b,this._uasFollowsRequestObject.activityType,this._uasFollowsRequestObject.resourceDomain)},f.prototype.setResourceType=function(a,b){b&&"district"===b&&(a.resourceType="postcodedistrict")},f}),function(a,b){if("function"==typeof define&&define.amd)return define("locservices/core/preferred_location",["./recent_locations","./data/tvandradio","./data/news","./data/weather","./uas_locations"],b);void 0===a.locservices&&(a.locservices={}),void 0===a.locservices.core&&(a.locservices.core={}),a.locservices.core.PreferredLocation=b(a.locservices.core.RecentLocations,a.locservices.core.data.TvAndRadio,a.locservices.core.data.News,a.locservices.core.data.Weather)}(this,function(a,b,c,d,e){"use strict";function f(b,c){c=c||{},this.api=b,this.isUASSupported=!1,this.recentLocations=new a,this.isUASReadEnabled=!1,this.isUASWriteEnabled=!1,"function"==typeof e&&(window.location.hostname.indexOf("bbc.com"),location.hostname.length,c.uasConfig&&(this.uasLocations=new e(c.uasConfig),this.isUASSupported=this.uasLocations.isSupported())),"object"==typeof c&&(this.isUASReadEnabled=!0===c.isUASReadEnabled,this.isUASWriteEnabled=!0===c.isUASWriteEnabled)}var g,h={e:"england",n:"northernireland",s:"scotland",w:"wales"},i=!1,j=!1,k=[],l=function(a,b){a&&"function"==typeof a.error&&a.error(b)},m=function(a,b){a&&"function"==typeof a.success&&a.success(b)};return f.prototype._resetUASState=function(){i=!1,j=!1,k=[],g=void 0},f.prototype.isValidLocation=function(a){var b,c;return"object"==typeof a&&(b=a.placeType,c=a.country,!("settlement"!==b&&"airport"!==b&&"district"!==b||"GB"!==c&&"GG"!==c&&"IM"!==c&&"JE"!==c))},f.prototype.isLocServCookieSet=function(){return null!==this.getLocServCookie()},f.prototype.unset=function(a){this.unsetLocServCookie(),this.isUASSupported&&this.isUASWriteEnabled?this.uasLocations.removePreferred(a):m(a)},f.prototype.unsetLocServCookie=function(){var a=this.getCookieDomain();return!1!==a&&(this.setDocumentCookie("locserv=; expires=Thu, 01 Jan 1970 00:00:01 GMT; Path=/; domain="+a+";"),!0)},f.prototype.isValidLocationId=function(a){return"string"==typeof a&&""!==a.replace(/^\s+|\s+$/g,"")},f.prototype.getHostname=function(){return window.location.hostname},f.prototype.getDocumentCookie=function(){return window.document.cookie},f.prototype.setDocumentCookie=function(a){window.document.cookie=a},f.prototype.getCookieDomain=function(){var a,b;return this.cookieDomain?this.cookieDomain:"string"==typeof(b=this.getHostname())&&(a=b.match(/bbc\.co(\.uk|m)$/),a&&2===a.length?this.cookieDomain="."+a[0]:this.cookieDomain=!1,this.cookieDomain)},f.prototype.getLocServCookie=function(){var a,b;return a=this.getDocumentCookie(),b=a.match(new RegExp("locserv=(.*?)(;|$)")),!b||b.length<2?null:b[1]},f.prototype.getLocServCookieLocation=function(a){var e,f,g,i,j,k,l,m,n,o,p,q,r;if(j=function(a){var b,c,d,e,f={},g=!1;if(!(a.length<3)){for(c=a.substr(0,1),a=a.substr(3),d=a.split(":"),b=0;b<d.length;b++)e=d[b].split("="),2===e.length&&(g=!0,e[1]=e[1].replace(/\+/g,"%20"),f[e[0]]=decodeURIComponent(e[1]));return!1===g&&(f=!1),{name:c,data:f}}},!(f=this.getLocServCookie()))return null;for(e={id:null,name:null,nation:null,news:null,weather:null,tvandradio:null},r=!1,g=f.substr(2).split("@"),k=0;k<g.length;k++)(i=j(g[k]))&&!1!==i.data&&("l"===i.name?(r=!0,e.id=i.data.i,e.name=i.data.n,i.data.c&&(e.container=i.data.c),i.data.y&&(e.country=i.data.y),i.data.p&&(e.placeType=i.data.p),i.data.h&&(e.nation=h[i.data.h])):"w"===i.name?(p=new d,!1!==(q=p.get(i.data))&&(e.weather=q)):"n"===i.name?(n=new c,!1!==(o=n.get(i.data.r||a))&&(e.news=o)):"d"===i.name&&(l=new b,!1!==(m=l.get(i.data))&&(e.tvandradio=m)));return r||(e=null),e},f.prototype.setLocServCookieLocation=function(a,b){var c,d,e,f;return c=this,"object"!=typeof a?void(b&&b.error&&l(b,"PreferredLocation.setLocServCookieLocation() must now be called with a location search result object")):void 0===this.api||!1===this.isValidLocationId(a.id)?void l(b):(this.cookieLocation=void 0,!1===(e=c.getCookieDomain())?void l(b):(d={params:{},success:function(a){var d,g;g=new Date(1e3*a.expires).toUTCString(),d="locserv="+a.cookie+"; ",d+="expires="+g+"; ",d+="domain="+e+"; ",d+="path=/;",b&&b.newsRegionId&&(f=b.newsRegionId),c.setDocumentCookie(d),m(b,c.getLocServCookieLocation(f))},error:function(a){l(b,a)}},b&&b.newsRegionId&&(d.params.news_region_id=b.newsRegionId),void this.api.getCookie(a,d)))},f.prototype.get=function(a){var b,c;b=this;var d=function(a){var b;for(j=!1,i=!0,g=a,b=0;b<k.length;b++)m(k[b],a);k=[]},e=function(){var a,b;for(j=!1,b=k,k=[],a=0;a<b.length;a++)c?m(b[a],c):l(b[a])},f=function(a){var c;a&&a.news&&1===a.news.length&&(c=a.news[0].id),b.setLocServCookieLocation(a.id,{newsRegionId:c,success:function(b){d(a)},error:function(){e()}})};if(c=this.getLocServCookieLocation(),!this.isUASSupported||!this.isUASReadEnabled||i)return void m(a,c);"object"==typeof a&&k.push(a),j||(j=!0,this.uasLocations.getPreferred({success:function(a){void 0===a||null!==c&&c.id===a.id?a?d(a):c?d(c):d():f(a)},error:function(){e()}}))},f.prototype.set=function(a,b){var c,d;if("object"!=typeof a)return void(b&&b.error&&l(b,"PreferredLocation.set() must now be called with a location search result object"));c=this,b=b||{},d=this.getLocServCookieLocation();var e=function(a){c.uasLocations.setPreferred(a,{success:function(){m(b,a)},error:function(){l(b)}})};this.setLocServCookieLocation(a,{newsRegionId:b.newsRegionId,success:function(f){c.recentLocations.isSupported()&&(c.recentLocations.remove(a.id),d&&a.id!==d.id&&c.recentLocations.add(d)),c.isUASSupported&&c.isUASWriteEnabled?e(f):m(b,f)},error:function(){l(b)}})},f}),define("locservices/ui/utils/stats",["locservices/ui/mediator/events","locservices/core/geolocation","locservices/core/recent_locations","locservices/core/cookies","locservices/core/bbc_cookies","locservices/core/preferred_location","istats-1"],function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){var d={},e="location_"+b;return"object"!=typeof a?d:(d.locationId=a.id,d.locationPlaceType=a.placeType||null,d.locationCountry=a.country||null,d.locationName=a.name||null,a.container&&(d.locationName+=", "+a.container),d.location_namespace=e,q&&(d.addedToRecentLocations=!0),c&&(d.id_mylocationname=a.name),c&&a.placeType===k&&(d.id_mylocationtype=a.name),d.module_name=j,d)}function i(a,b){if(b=b||{},this.namespace=b.namespace||"locservices:ui",l||(this.logUserActionEvent("locservices_user",u),l=!0),!a||"object"!=typeof a)throw new Error("The stats module requires an instance of an client");this._locservCookie=n,this._client=a,this._registeredNamespaces={},this.registerNamespace(this.namespace)}var j="location",k="district",l=!1,m=new f,n=m.getLocServCookieLocation(),o=m.isLocServCookieSet()&&n&&null!==n,p=new c,q=p.isSupported(),r=q?p.all():[],s=function(){var a="bbc-locservices-ui-js";try{return localStorage.setItem(a,a),localStorage.removeItem(a),!0}catch(a){return!1}}(),t=function(){
return o?Array.isArray(n.news)?n.news[0]:n.news:null}(),u={capability_geolocation:b.isSupported,capability_recent_locations:p.isSupported(),capability_local_storage:s,capability_cookies_enabled:(new d).isSupported(),capability_bbccookies_preference_enabled:(new e).isPersonalisationDisabled(),has_locserv_cookie:o,has_recent_locations:q&&r.length>0,recent_locations_total:q?r.length:0,locserv_nation:o?n.nation:"",locserv_news_region:o&&t?t.name:""};return i.prototype.registerNamespace=function(b){return!0!==this._registeredNamespaces[b]&&(a.on(b+":component:search:focus",function(){var a="location_"+b;this.logUserActionEvent("search-start",{location_namespace:a,module_name:j})}.bind(this)),a.on(b+":component:search_results:results",function(a){var c,d="location_"+b;c="results-"+(0===a.totalResults?"null":"multiple"),this.logUserActionEvent(c,{searchTerm:a.searchTerm,location_namespace:d,module_name:j})}.bind(this)),a.on(b+":component:search_results:result-single",function(a){var c="location_"+b;this.logUserActionEvent("results-single",{searchTerm:a.searchTerm,location_namespace:c,module_name:j})}.bind(this)),a.on(b+":component:search_results:show_more:clicked",function(){var a="location_"+b;this.logUserActionEvent("results-show-more",{location_namespace:a,module_name:j})}.bind(this)),a.on(b+":component:search_results:location:clicked",function(a){var c;c=Array.isArray(a)?a[0]:a,this.logUserActionEvent("results-select",h(c,b))}.bind(this)),a.on(b+":component:auto_complete:results",function(a){var c="location_"+b;this.logUserActionEvent("autocomplete-search",{searchTerm:a.searchTerm,location_namespace:c,module_name:j})}.bind(this)),a.on(b+":component:auto_complete:location",function(a){Array.isArray(a)&&(a={location:a[0],searchTerm:a[1]}),this.logUserActionEvent("autocomplete-select",h(a.location,b))}.bind(this)),a.on(b+":component:geolocation:click",function(){var a="location_"+b;this.logUserActionEvent("geolocation-click",{location_namespace:a,module_name:j})}.bind(this)),a.on(b+":component:geolocation:location",function(a){var c=Array.isArray(a)?a[0]:a;this.logUserActionEvent("geolocation-select",h(c,b))}.bind(this)),a.on(b+":error",function(a){var c=Array.isArray(a)?a[0].code:a.code,d="location_"+b;"geolocation.error.browser.permission"!==c&&"geolocation.error.browser.permission.insecure_origin"!==c||this.logUserActionEvent("geolocation-null",{location_namespace:d,module_name:j})}.bind(this)),a.on(b+":component:follow_button:location_added",function(a){var c=Array.isArray(a)?a[0]:a;this.logUserActionEvent("add",h(c,b,!0),!0)}.bind(this)),a.on(b+":component:follow_button:location_removed",function(a){var c=Array.isArray(a)?a[0]:a;this.logUserActionEvent("remove",h(c,b,!0),!0)}.bind(this)),a.on(b+":component:locations_list:location_removed:list",function(a){var c=Array.isArray(a)?a[0]:a;this.logUserActionEvent("remove-list",h(c,b,!0),!0)}.bind(this)),a.on(b+":component:locations_list:mylocation:searched",function(a){var c="location_"+b;this.logUserActionEvent("select-reg-search",{location_namespace:c,searchTerm:a,module_name:j},!0)}.bind(this)),a.on(b+":component:locations_list:location",function(a){var c="location_"+b;this.logUserActionEvent("select",{location:a,location_namespace:c,module_name:j},!0)}.bind(this)),a.on(b+":component:user_profile_location:location",function(a){var c=Array.isArray(a)?a[0]:a;this.logUserActionEvent("select-reg",h(c,b,!0),!0)}.bind(this)),this._registeredNamespaces[b]=!0,!0)},i.prototype.logUserActionEvent=function(a,b,c){if("search_no_results"!==a){var d=!0===c?"mylocations":j;g.log(a,d,b||{})}},i.prototype.getStatsAppName=function(){function a(a){if(""!==a&&void 0!==a)return!0}var b=[],c=this._client._getLabels(),d=this._client.getSite(),e=c.app_name||"";return b=[d,e,c.app_type||""].filter(a),e=b.join("-")},i}),define("locservices/ui/controller/news",["locservices/core/api","locservices/ui/mediator/events","locservices/ui/component/geolocation","locservices/ui/component/search","locservices/ui/component/search_results","locservices/ui/component/auto_complete","locservices/ui/component/close_button","locservices/ui/component/message","locservices/ui/utils/utils","locservices/ui/utils/stats"],function(a,b,c,d,e,f,g,h,i,j){function k(k){var n=this;m(k),this.namespace=k.namespace||"news-controller","object"==typeof k.stats&&(this._stats=new j(k.stats,{namespace:this.namespace})),this.api=new a(k.apiConfig),this.translations=k.translations,this.autoComplete=k.autoComplete||!1,this.alwaysOpen=k.alwaysOpen||!1,this.displayCloseButton=!k.alwaysOpen,this.smallGeo=void 0===k.smallGeo||k.smallGeo,this.isActive=!1,this.outside=k.container,this.focusOnInput=!0===k.focusOnInput,i.addClass(this.outside,"clearfix"),this.inside=document.createElement("div"),this.outside.appendChild(this.inside),i.addClass(this.inside,"ls-c-news clearfix ls-ui-ctrl-cold-start"),i.addClass(this.inside,!1===n.supportsTouch()?"no-touch":"");var o=document.createElement("div");this.inside.appendChild(o);var p=document.createElement("div");p.className="ls-c-news__geolocation-container",o.appendChild(p);var q=document.createElement("div");q.className="ls-c-news__search-container",o.appendChild(q);var r=document.createElement("div");r.className="ls-c-news__message-container",this.inside.appendChild(r);var s=document.createElement("div");if(s.className="ls-c-news__search-results-container",this.inside.appendChild(s),!1===k.smallGeo?(this.wide=!0,i.addClass(this.inside,"ls-c-news__wide")):this.wide=!1,this.geolocation=new c({api:this.api,translations:this.translations,eventNamespace:this.namespace,container:p,wide:this.wide}),this.search=new d({api:this.api,translations:this.translations,eventNamespace:this.namespace,container:q,locationName:k.locationName}),this.searchResults=new e({api:this.api,translations:this.translations,eventNamespace:this.namespace,container:s,persistResultsOnClick:!0}),this.message=new h({translations:this.translations,eventNamespace:this.namesapce,container:r,outerDiv:this.inside}),this.autoComplete&&(this.autoComplete=new f({api:this.api,translations:this.translations,eventNamespace:this.namespace,element:this.search.input,container:s})),this.alwaysOpen&&(i.addClass(this.outside,"ls-ui-ctrl-open"),this.isActive=!0,b.emit(this.namespace+":controller:active"),i.addClass(this.inside,"ls-ui-ctrl-active")),!1===this.wide&&this.displayCloseButton){this.closeButton=new g({translations:this.translations,eventNamespace:this.namespace,container:this.outside});var t=this.outside.querySelector(".ls-ui-comp-close_button");t&&(i.addClass(t,"ls-u-hidden"),t.setAttribute("aria-hidden",!0))}this.events={onError:function(a){n.events.onActive(),n.results&&n.results.clear(),n.autoComplete&&n.autoComplete.clear();var b=a[0];return"code"in b?n.message.set(n.translations.get(b.code)):"message"in b?n.message.set(n.translations.get(b.message)):void 0},onActive:function(){n.isActive||(b.emit(n.namespace+":controller:active"),i.addClass(n.inside,"ls-ui-ctrl-active"),n.isActive=!0),!1===n.alwaysOpen&&n.toggleCloseButtonVisibility(!0)},onGeolocationAvailable:function(){b.emit(n.namespace+":controller:geolocation:available"),i.addClass(n.inside,"ls-ui-ctrl-geolocation")},onSearchResults:function(a){n.message.clear();var b=a.searchTerm,c=a.offset,d=a.totalResults;if((void 0===d||0===d)&&null!==b)return n.message.set(n.translations.get("search.error.no_results",{searchTerm:b}));var e=c+10;return e=e>a.totalResults?a.totalResults:e,n.message.set(n.translations.get("message.total_results.formatted",{current:e,total:d}))},onLocation:function(a){n.message.clear(),n.search.clear(),n.selectLocation(a),n.toggleCloseButtonVisibility(!1)},onResultsClear:function(){n.message.clear(),n.searchResults.clear()},onClose:function(){if(n.isActive&&(n.isActive=!1,n.search.clear(),n.message.clear(),b.emit(n.namespace+":controller:inactive"),i.removeClass(n.inside,"ls-ui-ctrl-active")),!1===n.alwaysOpen){if(i.hasClass(n.inside,"ls-ui-ctrl-cold-start"))return void n.toggleCloseButtonVisibility(!1);i.addClass(n.outside,"gs-u-display-none"),i.removeClass(n.outside,"gs-u-display-inline-block")}}},n.search.container.querySelector(".ls-c-search__input")&&n.focusOnInput&&n.setInputToAutofocus(n.search.container),b.on(n.namespace+":error",this.events.onError),b.on(n.namespace+":component:search:focus",this.events.onActive),b.on(n.namespace+":component:search:start",this.events.onActive),b.on(n.namespace+":component:search:clear",this.events.onResultsClear),b.on(n.namespace+":component:geolocation:click",this.events.onActive),b.on(n.namespace+":component:search_results:results",this.events.onSearchResults),b.on(n.namespace+":component:auto_complete:render",this.events.onResultsClear),b.on(n.namespace+":component:auto_complete:clear",this.events.onResultsClear),b.on(n.namespace+":component:auto_complete:location",this.events.onLocation),b.on(n.namespace+":component:geolocation:location",this.events.onLocation),b.on(n.namespace+":component:search_results:location",this.events.onLocation),b.on(n.namespace+":component:close_button:clicked",this.events.onClose),b.on(n.namespace+":component:geolocation:available",this.events.onGeolocationAvailable),!0===this.smallGeo&&(this.reorderElements(o,p,q),n.debounced=i.debounce(function(){this.reorderElements(o,p,q)},l),window.addEventListener("resize",function(){n.debounced()}),window.addEventListener("orientationchange",function(){n.debounced()}))}var l=200,m=function(a){for(var b=["apiConfig","namespace","container","translations","placeTypes"],c=b.length,d=0;d<c;d++){var e=b[d];if(!a[e])throw new Error("News Controller requires an "+e+" option.")}var f=a.apiConfig||void 0;"object"==typeof f&&n(f)},n=function(a){for(var b=["api_key"],c=b.length,d=0;d<c;d++){var e=b[d];if(!a[e])throw new Error("News Controller requires an  "+e+" option.")}};return k.prototype.setInputToAutofocus=function(a){var b=a.querySelector(".ls-c-search__input");b&&b.setAttribute("autofocus",!0)},k.prototype.reorderElements=function(a,b,c){window.innerWidth>600?"ls-c-news__geolocation-container"===a.childNodes[0].className&&(a.removeChild(b),a.appendChild(b)):"ls-c-news__search-container"===a.childNodes[0].className&&(a.removeChild(c),a.appendChild(c))},k.prototype.selectLocation=function(a){var c=this;Array.isArray(a)&&(a=a[0]),b.emit(c.namespace+":controller:location",[a])},k.prototype.supportsTouch=function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0},k.prototype.toggleCloseButtonVisibility=function(a){var b=this.outside.querySelector(".ls-ui-comp-close_button");b&&(a?(i.removeClass(b,"ls-u-hidden"),b.setAttribute("aria-hidden",!1)):(i.addClass(b,"ls-u-hidden"),b.setAttribute("aria-hidden",!0)))},k}),define("locservices/ui/translations/en",[],function(){"use strict";function a(){}var b={"auto_complete.error.search":"Sorry, we are experiencing technical problems.","user_locations.heading.preferred":"Main location","user_locations.heading.other_locations":"Other locations","user_locations.heading.your_locations":"Your locations","user_locations.action.recent":"Prefer","user_locations.action.remove":"Remove","user_locations.dialog.yes":"Yes","user_locations.dialog.no":"No","user_locations.dialog.settings":"Go to settings","user_locations.dialog.cancel_settings":"Cancel","user_locations.dialog.remove":"Remove? ","user_locations.dialog.edit":"Edit? ","user_locations.action.label.prefer":"Stopio defnyddio {name} fel eich prif leoliad","user_locations.action.label.remove":"Remove {name} as your main location","user_locations.action.label.delete":"Remove {name} from other locations","user_locations.dialog.remove_preferred":"We will no longer use {{name}} to give you relevant local info across the BBC.","user_locations.dialog.prefer":"We will now use {{name}} to give you relevant local info across the BBC.","user_locations.dialog.remove_homelocation":"We will not be able to remove {location} as it's your home location","user_locations.dialog.home.redirect":"Want to edit your home postcode? You need to go to your account settings to do this. It helps us keep you safe.","user_locations.popover.home.redirect":"Want to edit your home postcode?","user_locations.popover.remove_homelocation":"You need to go to your account settings to do this. It helps us keep you safe.","user_locations.popover.homelocation_link_title":"Click here to edit","user_locations.message.preferred":"We'll use your location to give you relevant local info across the BBC.","user_locations.message.change_preferred":"Hit the star next to one of your other locations to make it your main location. If you are signed in to the BBC we will store the main location with your BBC account.","user_locations.error.preferred_location":"Sorry, we are experiencing technical problems.","user_profile_location.heading":"Home location","user_profile_location.edit":"Edit your home location","user_profile_location.label":"Home","user_profile.cta_prompt":"Sign in or Register to start adding.","close_button.label":"Close","close_button.label_locations":"Close location search","header.my_locations":"My Locations","header.recent_locations":"Recent Searches","follow_button.action.adding":"Adding","follow_button.action.added":"Added","follow_button.action.add":"Add","follow_button.action.to_my_locations":" to My Locations","follow_button.action.remove":"Remove","follow_button.action.removed":"Removed","follow_button.action.removing":"Removing","follow_button.invalid.title":"Your location {location} is a foreign location","follow_button.invalid.description":"You are not able to save a foreign location to My Locations","follow_button.invalid_full.title":"Your list of locations is full.","follow_button.invalid_full.description":"To add {location}, you first need to remove some other locations.","follow_button.invalid_type.title":"Your location is a {type}.","follow_button.invalid_type.description":"You are not able to save a location that is a {type} to My Locations","follow_button.home.title":"Your location {location} is home location","follow_button.home.description":"You are directed to edit page.","follow_button.nocta.title":"Remember the places that matter to you","follow_button.nocta.description":'Add them to "My Locations" to get relevant local info across the BBC.',"popover.action.signin":"Sign in","popover.label.or":" or ","popover.action.register":"Register","popover.label.close":"Close dialog","popover.location_error_title":"Unable to save location.","popover.location_error_description":"Sorry, we are experiencing technical problems.","favourite.popover.added.title":"{location} has been added to My Locations","favourite.popover.added.description":"We'll use it to give you relevant local info across the BBC.","favourite.popover.remove.title":"{location} has been removed from My Locations","favourite.popover.remove.description":"We won't use it to give you relevant local info across the BBC any more.","favourite.popover.error.content":"Something's gone wrong. Please try again later","favourite.info_link":"Find out more","search.placeholder":"Enter a town, city or UK postcode","search.error.search":"Sorry, we are experiencing technical problems.","search.error.no_results":'We couldn\'t find any results for "{searchTerm}"',"search.clear":"Clear input.","search.submit":"Search","search.submit.title":"Search for a location","search_results.more":"Show More","search_results.more_title":"Show more results","geolocation.button.label":"Find my location","geolocation.error.http":"We are unable to use your location.","geolocation.error.browser":"We are unable to use your location.","geolocation.error.browser.permission":"Please enable Location Services in your device settings or browser then refresh.","geolocation.error.outsideContext":"Your location is not currently supported by this application.","geolocation.error.browser.permission.insecure_origin":"Geolocation is currently not available. Please use search instead.","message.action.close":"Close","message.geolocation.detect":"Detecting your location.","message.results":'Search results for "{searchTerm}"',"message.total_results":"Showing {current} of {total} results","message.total_results.formatted":"Showing <strong>{current}</strong> of <strong>{total}</strong>","primary.cold_start":"Would you like us to use {{name}} as your main location to give you relevant local info across the BBC?","primary.cold_start.confirm":"Yes","primary.cold_start.cancel":"No","primary.info_link":"How does the BBC use my location?","primary_search.close":"Close","test.interpolation":"Value {a} and value {b}.","locations_list.action.show_more":"Show More","locations_list.action.show_more_title":"Show more results","locations_list.action.show_less":"Show Less","locations_list.action.show_less_title":"Show less results","locations_list.action.clear_all":"Clear All","locations_list.no_my_locations":"<p>We use your postcode to give you relevant local info across the BBC.</p><p>Add more locations to keep up with what’s happening in the places you care about.</p>","locations_list.no_recent_locations":"<p>You haven't searched for any locations yet.</p><p>Previous searches will appear here.</p>","locations_list.clear_recents":"This will remove all of your Recent searches"};return a.prototype.get=function(a,c){var d;return!!b.hasOwnProperty(a)&&(d=b[a],"object"==typeof c&&(d=String(d).replace(/\{([^{}]*)\}/g,function(a,b){return c.hasOwnProperty(b)?c[b]:a})),d)},a.prototype.set=function(a,c){return"string"==typeof a&&""!==a&&void 0!==c&&(b[a]=c,!0)},a}),define("news-location-search",["locservices/ui/controller/news","locservices/ui/translations/en","locservices/ui/mediator/events","locservices/core/data/news","locservices/core/preferred_location","locservices/core/geolocation","locservices/core/api"],function(a,b,c,d,e,f,g){return{NewsController:a,En:b,Events:c,News:d,PreferredLocation:e,Geolocation:f,Api:g}});